The backend consists of small isolated microservices. To keep code duplication to a minimum and ensure a basic infrastrcture all services can use and rely on, there are some services that are deployed globally:
- API Gateway
- API Gateway ID sharing server
- Templates and functions for deployment
- Default Lambda handler for OPTIONS methods

## API Gateway
The API Gateway serves as the connection between the backend services and the frontend. The frontend must be able to make call to a URL to receive HTTP responses from the backend. The backend services must be able to register their functions on a given URL path. This is provided by the API Gateway. The service [apig-main](./apig-main/) creates an API Gateway, see the README for more information.

## APIU Gateway ID sharing server
In order to make the generated URL available to the frontend service, a small Flask is deployed. Its sole job is to provide the URL generated by apig-main to the frontend. The frontend can then call the server and receives the URL on which it can make subsequent calls.  
This setup is neccesary since we can not provide a static URL which would require various pro features of localstack.

## Templates
The folder [template-microservice](./template-microservice/) contains a template for a microservice with all neccesary configuraitons, labmda handlers, a deploy scirpt and a dockerfile. It also contains the following files that are used by all new microservice:
- [deploy_utils.py](./template-microservice/deploy_utils.py)
- [deploy.py](./template-microservice/deploy.py)

Those two scripts take care of the deployment of the specified resources (DynamoDB tables, Lambda functions, API routes etc).

## Default Lambda handler for OPTIONS methods
During deployment we ran into CORS errors which blocked calls from the frontend to the backend. To enable CORS with API Gateway, each route must implement an OPTIONS method which sends the appropirate headers in a prefetch. (https://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-cors.html). To reduce code duplication, the service [options_lambda_function](./options_lambda_function/) deploys a lambda handler which simply returns a 200 message and the appropirate CORS headers. This function is deployed once and used by all other microservices for each integrated route.